<div class="pagos-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <div class="header-content">
          <button mat-raised-button color="primary" (click)="abrirModalCrear()" [disabled]="parqueaderos.length === 0">
            <mat-icon>add</mat-icon>
            Nuevo Pago
          </button>
        </div>
        <div style="height: 16px;"></div>
        <app-filtro-parqueaderos
          [parqueaderos]="parqueaderos"
          [parqueaderoSeleccionado]="parqueaderoSeleccionado"
          (parqueaderoCambia)="onParqueaderoCambia($event)">
        </app-filtro-parqueaderos>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (loading) {
        <div class="loading-container">
          <mat-spinner></mat-spinner>
          <p>Cargando pagos...</p>
        </div>
      } @else {
        @if (parqueaderos.length === 0) {
          <div class="no-data">
            <mat-icon>info</mat-icon>
            <p>No hay parqueaderos registrados para su empresa</p>
          </div>
        } @else {


          @if (errorMessage) {
            <div class="mensaje-error">
              <mat-icon color="warn">error</mat-icon>
              <span>{{ errorMessage }}</span>
            </div>
          }


          @if (mensajeExito) {
            <div class="mensaje-exito">
              <mat-icon color="primary">check_circle</mat-icon>
              <span>{{ mensajeExito }}</span>
            </div>
          }

          
          @if (pagos.length === 0 && parqueaderoSeleccionado) {
            <div class="no-data">
              <mat-icon>info</mat-icon>
              <p>No hay pagos registrados para este parqueadero</p>
            </div>

          } @else if (parqueaderoSeleccionado) {
            <div class="table-container">

              <table mat-table [dataSource]="pagos" class="pagos-table">
                <ng-container matColumnDef="id">
                  <th mat-header-cell *matHeaderCellDef>ID</th>
                  <td mat-cell *matCellDef="let pago">{{ pago.id }}</td>
                </ng-container>

                <ng-container matColumnDef="idReserva">
                  <th mat-header-cell *matHeaderCellDef>ID Reserva</th>
                  <td mat-cell *matCellDef="let pago">{{ pago.reserva.id }}</td>
                </ng-container>

                <ng-container matColumnDef="monto">
                  <th mat-header-cell *matHeaderCellDef>Monto</th>
                  <td mat-cell *matCellDef="let pago">${{ pago.monto }}</td>
                </ng-container>

                
                <ng-container matColumnDef="fechaPago">
                  <th mat-header-cell *matHeaderCellDef>Fecha Pago</th>
                  <td mat-cell *matCellDef="let pago">{{ pago.fechaPago | date:'short' }}</td>
                </ng-container>
                <ng-container matColumnDef="idMetodoPago">
                  <th mat-header-cell *matHeaderCellDef>Metodo de Pago</th>
                  <td mat-cell *matCellDef="let pago">{{ pago.metodoPago.nombre }}</td>
                </ng-container>

                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef>Acciones</th>
                  <td mat-cell *matCellDef="let pago">
                    <button 
                      mat-raised-button 
                      color="accent" 
                      (click)="verFactura(pago)"
                      class="accion-btn">
                      <mat-icon>receipt_long</mat-icon>
                      Factura
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


              </table>
            </div>
          }
        }
      }
    </mat-card-content>
  </mat-card>
</div>